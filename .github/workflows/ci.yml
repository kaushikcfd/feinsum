name: CI
on:
  push:
    branches:
    - main
  pull_request:

jobs:
  ruff:
    runs-on: ubuntu-latest
    steps:
      - uses: ./.github/actions/activate-test-conda-env
      - run: |
          which python
          python -V
          ruff check

  mypy:
    runs-on: ubuntu-latest
    steps:
      - uses: ./.github/actions/activate-test-conda-env
      - run: |
          mypy --show-error-codes --strict src/feinsum/

  pytest:
    runs-on: ubuntu-latest
    steps:
      - uses: ./.github/actions/activate-test-conda-env
      - run: |
          cd test
          pytest -vx .

  build-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: ./.github/actions/activate-test-conda-env
      - run: |
          which python
          python -V
          cd doc
          make html SPHINXOPTS="-W --keep-going -n"
