name: CI
on:
  push:
    branches:
    - main
  pull_request:

jobs:
  ruff:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - uses: ./.github/actions/activate-test-conda-env
        with:
          run_in_env: |
            ruff check

  mypy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - uses: ./.github/actions/activate-test-conda-env
        with:
          run_in_env: |
            mypy --show-error-codes --strict src/feinsum/

  pytest:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - uses: ./.github/actions/activate-test-conda-env
        with:
          run_in_env: |
            cd test
            pytest -vx .

  build-docs:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
      - uses: ./.github/actions/activate-test-conda-env
        with:
          run_in_env: |
            cd doc
            make html SPHINXOPTS="-W --keep-going -n"
